---
title: CDN とは？仕組みから活用方法まで
emoji: "\U0001F6DC"
tags:
- CDN
published: true
published_at: '2025-06-08'
source: zenn
source_url: https://zenn.dev/manamana/articles/27cd19eb2dd0bf
---

## 想定読者

- CDN について知りたい駆け出しエンジニア
- CDN の仕組みについて整理したいエンジニア

## CDN とは

Content Delivery Network の略で、Web 上のコンテンツを効率よく、スピーディに配信するために作られた仕組みのこと。CDN はユーザーから直接見える形で存在しているものではないが、身近なサービスを裏側から支える重要な役割を担っている

## CDN のコンセプト

CDN は Web 上のコンテンツ（静的ファイルや画像など）を毎回元のサーバーから取得する代わりに、世界中に配置されたエッジサーバー（キャッシュサーバー）からコンテンツのキャッシュを配信し、取得できるようにするもの

## CDN の仕組み

ここからは、CDN の仕組みを実際に順を追って説明していく ↓

まず、CDN はユーザーとオリジンサーバーの間に配置される形で展開され、CDN 展開直後はオリジンサーバーのみがコンテンツ（静的ファイルや画像のこと、ここでは仮に `content.png` とする）を持っている

オリジンサーバーはサイトの開発者が用意している、Web サイトやサービスを提供する大本のサーバーのことで、CDN（エッジサーバー、キャッシュサーバー）と区別するためにオリジンサーバーと呼ぶ
![ユーザー、CDN（エッジサーバー）、オリジンサーバーの繋がり](/images/user_cdn_origin.png)

---

CDN を展開した直後はコンテンツはオリジンサーバーのみが持っているので、最初のアクセス時は以下のような流れになる

1. ユーザーがエッジサーバーに`content.png`をリクエスト
2. エッジサーバーがオリジンサーバーに`content.png`をリクエスト
3. オリジンサーバーがエッジサーバーに`content.png`を返送
4. エッジサーバーがユーザーに`content.png`を返送

そしてこの、エッジサーバーがユーザーにコンテンツを返送するところで、エッジサーバーは同時に`content.png`をキャッシュすることも行う
![CDNがキャッシュするタイミングの画像](/images/cdn_cache_timing.png)

---

次に、別のユーザーがアクセスしてきたときのことを考える
この時は先ほどとは違って、エッジサーバーがコンテンツのキャッシュ（一時保存データ）を持っているので、オリジンサーバーに問い合わせることなく、エッジサーバーが代理でコンテンツを返送する
![CDNがキャッシュを代理でレスポンスする画像](/images/cdn_cache_response.png)

---

## CDN の仕組み補足

### キャッシュの有効期限（TTL）について

CDN では通常、TTL（Time to Live）という、コンテンツをキャッシュしておく期間（一時保存しておく期間）を設定することができる

:::message
TTL は秒単位で設定でき、30 秒、3600 秒（1 時間）、86400 秒（24 時間）など好きな風にカスタマイズして設定できる
:::

### キャッシュヒット率について

CDN（エッジサーバー）にアクセスしたときに、リクエストしたオブジェクトがキャッシュ（一時保存）から提供される割合のこと

:::message
→ つまり、キャッシュヒット率が高いほど CDN（エッジサーバー）のみで処理が完結するので、オリジンサーバーへの負荷を軽減することができるし、キャッシュを利用できるのでレスポンスも早い
:::

### キャッシュクリアについて

CDN のキャッシュに保存されたデータは、TTL が経過するかキャッシュクリアを行わないと消えない

:::message
→ そのため、キャッシュが残っている状態で新しいコンテンツに更新したとしても、以前のキャッシュデータを参照してしまって新しいコンテンツデータを取得できない！

→ そのように新しいコンテンツに更新した場合は CDN のキャッシュクリアを行う必要がある
:::

## まとめ

:::message

### CDN を使うメリット

- オリジンサーバーへの負荷を軽減することができる
- ユーザーに地理的に近いサーバーを利用し、キャッシュされたコンテンツをエッジサーバーが代理で返送することで、レスポンスが早い
  :::

## おまけ

CDN は画像などの静的アセットの配信以外にも静的サイトの配信としても利用することができる
その場合は、Amazon S3 というサービスを合わせて利用することが多い