<h1 id="%E3%81%A9%E3%82%93%E3%81%AA%E4%BA%BA%E5%90%91%E3%81%91%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%8B" data-line="0" class="code-line"><a class="header-anchor-link" href="#%E3%81%A9%E3%82%93%E3%81%AA%E4%BA%BA%E5%90%91%E3%81%91%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%8B" aria-hidden="true"></a> どんな人向けの記事か</h1>
<ul data-line="2" class="code-line">
<li data-line="2" class="code-line">AWS Lambda に Python ライブラリをインストールして使いたい人</li>
<li data-line="3" class="code-line">AWS Lambda で Import error に悩まされている人</li>
<li data-line="4" class="code-line">Mac を使っている方（Windows の場合も同様の手順でできると思いますが、適宜読み替えてください）</li>
</ul>
<h1 id="%E6%89%8B%E9%A0%86" data-line="6" class="code-line"><a class="header-anchor-link" href="#%E6%89%8B%E9%A0%86" aria-hidden="true"></a> 手順</h1>
<h2 id="%E5%A4%A7%E3%81%BE%E3%81%8B%E3%81%AA%E6%B5%81%E3%82%8C" data-line="8" class="code-line"><a class="header-anchor-link" href="#%E5%A4%A7%E3%81%BE%E3%81%8B%E3%81%AA%E6%B5%81%E3%82%8C" aria-hidden="true"></a> 大まかな流れ</h2>
<ol data-line="10" class="code-line">
<li data-line="10" class="code-line">ローカル環境に、AWS Lambda に設定した Python バージョンと同じ Python 環境を用意する</li>
<li data-line="11" class="code-line">ローカル環境で、必要なライブラリを <code>pip install</code> する（一部ライブラリは後述する whl をインストールしてから<code>pip install</code>する）</li>
<li data-line="12" class="code-line">ローカル環境で、必要なライブラリをすべて詰め込んだフォルダを zip 化する</li>
<li data-line="13" class="code-line">AWS Lambda で、レイヤーを追加し zip ファイルをアップロードする</li>
</ol>
<h2 id="1.-%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E7%92%B0%E5%A2%83%E3%81%A7%E3%80%81aws-lambda-%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%9F-python-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%A8%E5%90%8C%E3%81%98-python-%E7%92%B0%E5%A2%83%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B" data-line="15" class="code-line"><a class="header-anchor-link" href="#1.-%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E7%92%B0%E5%A2%83%E3%81%A7%E3%80%81aws-lambda-%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%9F-python-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%A8%E5%90%8C%E3%81%98-python-%E7%92%B0%E5%A2%83%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B" aria-hidden="true"></a> 1. ローカル環境で、AWS Lambda に設定した Python バージョンと同じ Python 環境を用意する</h2>
<p data-line="17" class="code-line">今回は Python 3.13 環境を作ります<br />
こちら ↓ の記事を参考に、pyenv をインストールして Python 3.13 をインストールしてください<br style="display:none" />
<a href="https://zenn.dev/hotani3/articles/setup-python-on-macos" rel="noreferrer noopener nofollow" target="_blank">https://zenn.dev/hotani3/articles/setup-python-on-macos</a><a href="https://zenn.dev/hotani3/articles/setup-python-on-macos" style="display:none" target="_blank">https://zenn.dev/hotani3/articles/setup-python-on-macos</a></p>
<p data-line="21" class="code-line">インストールが完了したら、<code>Python -V</code> （V は大文字）と打って <code>3.13.2</code> のように表示されれば OK です！</p>
<h2 id="2.-%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E7%92%B0%E5%A2%83%E3%81%A7%E3%80%81%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B" data-line="23" class="code-line"><a class="header-anchor-link" href="#2.-%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E7%92%B0%E5%A2%83%E3%81%A7%E3%80%81%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B" aria-hidden="true"></a> 2. ローカル環境で、必要なライブラリをインストールする</h2>
<p data-line="25" class="code-line">今回は JWT 認証を実装するため <code>PyJWT</code> と <code>cryptography</code> というライブラリをインストールする前提で進めます<br />
他のライブラリを使用したい場合は、適宜読み替えてください！</p>
<p data-line="28" class="code-line">まずはこちら ↓ のサイトで、インストールしたいライブラリを検索します<br style="display:none" />
<a href="https://pypi.org/" rel="noreferrer noopener nofollow" target="_blank">https://pypi.org/</a><a href="https://pypi.org/" style="display:none" target="_blank" rel="nofollow noopener noreferrer">https://pypi.org/</a></p>
<p data-line="31" class="code-line">ライブラリのページへ行き、<strong>ファイルをダウンロード</strong> をクリックすると対応するプラットフォームごとのファイル一覧が表示されます</p>
<aside class="msg alert"><span class="msg-symbol">!</span><div class="msg-content"><p data-line="34" class="code-line">pypi のサイトでインストールしたいライブラリを検索し、ライブラリページの表示内容によって以下 2 つの手順に分岐します！</p>
<p data-line="36" class="code-line"><strong><code>manylinux</code> 表示がない場合 ↓</strong><br />
<img src="/images/none_manylinux.png" alt="none_manylinux" /></p>
<p data-line="39" class="code-line"><strong><code>manylinux</code> 表示がある場合 ↓</strong><br />
<img src="/images/manylinux.png" alt="manylinux" /></p>
</div></aside>
<aside class="msg message"><span class="msg-symbol">!</span><div class="msg-content"><p data-line="44" class="code-line"><strong>A. pypi の該当ライブラリページのファイルをダウンロードセクションで、<code>manylinux</code> という表示がない場合</strong></p>
<ol data-line="46" class="code-line">
<li data-line="46" class="code-line">ライブラリインストール用のディレクトリを適当に作成する（<code>mkdir Sandbox</code> などでカレントディレクトリに Sandbox ディレクトリを作成できる）</li>
<li data-line="47" class="code-line"><code>cd Sandbox</code> で作成したディレクトリに移動し、<code>mkdir python</code> （ここは python という名前のディレクトリを作成すること）</li>
<li data-line="48" class="code-line">whl をインストールする手順をスキップし、<code>pip install -t python/</code> で python ディレクトリにライブラリをインストールする</li>
</ol>
</div></aside>
<aside class="msg message"><span class="msg-symbol">!</span><div class="msg-content"><p data-line="52" class="code-line"><strong>B. pypi の該当ライブラリページのファイルをダウンロードセクションで、<code>manylinux</code> という表示がある場合</strong></p>
<ol data-line="54" class="code-line">
<li data-line="54" class="code-line">
<p data-line="54" class="code-line">ライブラリインストール用のディレクトリを適当に作成する（<code>mkdir Sandbox</code> などでカレントディレクトリに Sandbox ディレクトリを作成できる）</p>
</li>
<li data-line="55" class="code-line">
<p data-line="55" class="code-line"><code>cd Sandbox</code> で作成したディレクトリに移動し、<code>mkdir python</code> （ここは python という名前のディレクトリを作成すること）</p>
</li>
<li data-line="56" class="code-line">
<p data-line="56" class="code-line">表示されているファイルの中で、<code>manylinux</code>、<code>x86-64</code>、<code>Python 3.13</code>（あれば）に対応している <code>.whl</code> ファイルをダウンロード</p>
</li>
<li data-line="57" class="code-line">
<p data-line="57" class="code-line">ダウンロードされた <code>.whl</code> ファイルを、カレントディレクトリ（この場合は/Sandbox）に移動させる</p>
<p data-line="59" class="code-line">（現在のディレクトリ構成は以下のようになっているはず）</p>
</li>
</ol>
<p data-line="61" class="code-line"><img src="/images/directory.png" alt="directory_image" /></p>
<ol start="5" data-line="63" class="code-line">
<li data-line="63" class="code-line">以下のコマンドを打ち、python ディレクトリへライブラリをインストールする<br />
（↓ は cryptography をインストールする例）</li>
</ol>
<div class="code-block-container"><pre class="language-shell"><code class="language-shell code-line" data-line="66">$ pip <span class="token parameter variable">--python</span> <span class="token number">3.13</span> <span class="token function">install</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--platform</span> manylinux2014_x86_64 <span class="token punctuation">\</span>
   <span class="token parameter variable">--target</span><span class="token operator">=</span>python <span class="token punctuation">\</span>
   <span class="token parameter variable">--implementation</span> <span class="token function">cp</span> <span class="token punctuation">\</span>
   --only-binary<span class="token operator">=</span>:all: <span class="token parameter variable">--upgrade</span> <span class="token punctuation">\</span>
   cryptography
</code></pre></div></div></aside>
<h2 id="3.-%E3%81%82%E3%81%A8%E3%81%AF-zip-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%8C%96%E3%81%99%E3%82%8B" data-line="77" class="code-line"><a class="header-anchor-link" href="#3.-%E3%81%82%E3%81%A8%E3%81%AF-zip-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%8C%96%E3%81%99%E3%82%8B" aria-hidden="true"></a> 3. あとは zip ファイル化する</h2>
<div class="code-block-container"><pre class="language-shell"><code class="language-shell code-line" data-line="79">$ <span class="token function">zip</span> <span class="token parameter variable">-r</span> layer.zip python
</code></pre></div><p data-line="83" class="code-line">ちなみに zip ファイルの名前は <code>layer.zip</code> でなくても、なんでも良い</p>
<h2 id="4.-aws-lambda-%E3%81%AB%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B" data-line="85" class="code-line"><a class="header-anchor-link" href="#4.-aws-lambda-%E3%81%AB%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B" aria-hidden="true"></a> 4. AWS Lambda にレイヤーを追加する</h2>
<p data-line="87" class="code-line">以下の手順で進めていく</p>
<ol data-line="89" class="code-line">
<li data-line="89" class="code-line">AWS コンソールの Lambda &gt; その他のリソース &gt; レイヤー へ移動する</li>
<li data-line="90" class="code-line">レイヤーを作成 をクリック</li>
<li data-line="91" class="code-line">名前（なんでも OK）、説明 などを入力して .zip ファイルをアップロードする（先ほど作成した zip ファイル）</li>
<li data-line="92" class="code-line">作成 をクリックし、レイヤーを作成する</li>
<li data-line="93" class="code-line">Lambda の コードセクションの最下部から、レイヤーの追加 をクリック</li>
<li data-line="94" class="code-line">カスタムレイヤーを選択し、先ほど作成したレイヤーを追加</li>
<li data-line="95" class="code-line">Lambda にレイヤーが追加されていることを確認し、完了</li>
</ol>
<h3 id="%E5%8F%82%E8%80%83-%E2%86%93" data-line="97" class="code-line"><a class="header-anchor-link" href="#%E5%8F%82%E8%80%83-%E2%86%93" aria-hidden="true"></a> 参考 ↓</h3>
<p data-line="99" class="code-line"><a href="https://qiita.com/Bashi50/items/1f72a93dbde23de55dda#%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC%E3%82%92%E8%BF%BD%E5%8A%A0" rel="noreferrer noopener nofollow" target="_blank">https://qiita.com/Bashi50/items/1f72a93dbde23de55dda#%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC%E3%82%92%E8%BF%BD%E5%8A%A0</a><a href="https://qiita.com/Bashi50/items/1f72a93dbde23de55dda#%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC%E3%82%92%E8%BF%BD%E5%8A%A0" style="display:none" target="_blank" rel="nofollow noopener noreferrer">https://qiita.com/Bashi50/items/1f72a93dbde23de55dda#レイヤーを追加</a></p>
