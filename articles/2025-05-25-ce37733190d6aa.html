<h2 id="%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" data-line="0" class="code-line"><a class="header-anchor-link" href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" aria-hidden="true"></a> この記事について</h2>
<p data-line="2" class="code-line">株式会社クオレガ 新人エンジニアの manamana です</p>
<p data-line="4" class="code-line">社内ツールで使用するための LINE WORKS Bot を作成して、AWS Lambda の環境で Bot を利用しようとしたときに、</p>
<ul data-line="6" class="code-line">
<li data-line="6" class="code-line">環境変数への秘密鍵の格納方法</li>
<li data-line="7" class="code-line">環境変数から秘密鍵を取り出すときのフォーマット処理</li>
</ul>
<p data-line="9" class="code-line">でかなりハマったので備忘録として残しておきます</p>
<h2 id="%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%B8%E3%81%AE%E7%A7%98%E5%AF%86%E9%8D%B5%E3%81%AE%E6%A0%BC%E7%B4%8D%E6%96%B9%E6%B3%95" data-line="11" class="code-line"><a class="header-anchor-link" href="#%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%B8%E3%81%AE%E7%A7%98%E5%AF%86%E9%8D%B5%E3%81%AE%E6%A0%BC%E7%B4%8D%E6%96%B9%E6%B3%95" aria-hidden="true"></a> 環境変数への秘密鍵の格納方法</h2>
<p data-line="13" class="code-line">秘密鍵では、改行コードも秘密鍵の一部なので改行コードを維持したまま環境変数に格納してあげる必要があります</p>
<p data-line="15" class="code-line">以下のコマンドで、もともとの秘密鍵の改行部分を <code>\n</code> という文字に置き換え、1 行化します（private.key には秘密鍵のファイル名を入れてください）</p>
<div class="code-block-container"><pre class="language-shell"><code class="language-shell code-line" data-line="17">$ <span class="token function">cat</span> private.key <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-e</span> :loop <span class="token parameter variable">-e</span> <span class="token string">'N; $!b loop'</span> <span class="token parameter variable">-e</span> <span class="token string">'s/\n/\\n/g'</span>
</code></pre></div><aside class="msg message"><span class="msg-symbol">!</span><div class="msg-content"><p data-line="22" class="code-line">秘密鍵には、<code>-----BEGIN PRIVATE KEY-----</code>や<code>-----END PRIVATE KEY-----</code>などのヘッダー、フッターも必要なので省略せず環境変数に記述してください</p>
</div></aside>
<h2 id="%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%8B%E3%82%89%E7%A7%98%E5%AF%86%E9%8D%B5%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99%E3%81%A8%E3%81%8D%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88%E5%87%A6%E7%90%86" data-line="25" class="code-line"><a class="header-anchor-link" href="#%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%8B%E3%82%89%E7%A7%98%E5%AF%86%E9%8D%B5%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99%E3%81%A8%E3%81%8D%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88%E5%87%A6%E7%90%86" aria-hidden="true"></a> 環境変数から秘密鍵を取り出すときのフォーマット処理</h2>
<p data-line="27" class="code-line">上記の手順で環境変数に秘密鍵を 1 行化して格納したら、実際に取り出して利用するときにはまた改行コードをもとに戻す必要があります<br />
Python での実装は以下のようになります</p>
<div class="code-block-container"><pre class="language-python"><code class="language-python code-line" data-line="30"><span class="token keyword">import</span> os
secret_key <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"SECRET_KEY"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\\n"</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="%E3%81%BE%E3%81%A8%E3%82%81" data-line="35" class="code-line"><a class="header-anchor-link" href="#%E3%81%BE%E3%81%A8%E3%82%81" aria-hidden="true"></a> まとめ</h2>
<p data-line="37" class="code-line">もっといい方法ないのかな...🤔</p>
